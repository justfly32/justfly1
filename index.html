<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>개인 웹페이지</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-auth.js"></script>
</head>
<body>
    <header>
        <div class="container">
            <h1>My Web</h1>
            <nav>
                <ul>
                    <li><a href="#home">홈</a></li>
                    <li><a href="#about">소개</a></li>
                    <li><a href="#portfolio">포트폴리오</a></li>
                    <li><a href="#contact">연락처</a></li>
                    <li><a href="#write">글 작성</a></li>
                </ul>
            </nav>
        </div>
    </header>
    <main>
        <section id="home" class="section">
            <div class="container">
                <h2>환영합니다!</h2>
                <p>여기는 개인 웹페이지입니다.</p>
            </div>
        </section>
        <section id="about" class="section">
            <div class="container">
                <h2>소개</h2>
                <p>자기소개 내용을 여기에 작성합니다.</p>
            </div>
        </section>
        <section id="portfolio" class="section">
            <div class="container">
                <h2>포트폴리오</h2>
                <p>여기에 프로젝트나 작업물을 소개합니다.</p>
            </div>
        </section>
        <section id="contact" class="section">
            <div class="container">
                <h2>연락처</h2>
                <p>연락처 정보를 여기에 기재합니다.</p>
            </div>
        </section>
        <section id="write" class="section">
            <div class="container">
                <h2>글 작성</h2>
                <form id="postForm">
                    <input type="text" id="title" placeholder="제목" required>
                    <textarea id="content" placeholder="내용" required></textarea>
                    <button type="submit">글 작성</button>
                </form>
                <ul id="posts"></ul>
                <div id="notification" style="display: none;">글이 성공적으로 저장되었습니다!</div>
            </div>
        </section>
    </main>
    <footer>
        <div class="container">
            <p>&copy; 2024 개인 웹페이지</p>
        </div>
    </footer>
    <script>
        // Firebase 초기화
        var firebaseConfig = {
            apiKey: "AIzaSyDYqB1qnIN3KuqkoYU9TyHQG2pfWKzWr_w",
            authDomain: "myweb-547bc.firebaseapp.com",
            databaseURL: "https://myweb-547bc-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "myweb-547bc",
            storageBucket: "myweb-547bc.appspot.com",
            messagingSenderId: "751450593114",
            appId: "1:751450593114:web:c67929288161dbfd3f8563",
            measurementId: "G-EFRG9SQ3ZC"
        };
        firebase.initializeApp(firebaseConfig);

        // Firebase 익명 로그인
        firebase.auth().signInAnonymously().catch(function(error) {
            var errorCode = error.code;
            var errorMessage = error.message;
            console.error('Authentication error:', errorCode, errorMessage);
        });

        firebase.auth().onAuthStateChanged(function(user) {
            if (user) {
                console.log('User signed in:', user);
                // 데이터베이스 참조
                var db = firebase.database().ref('posts');

                // 폼 제출 이벤트 처리
                document.getElementById('postForm').addEventListener('submit', function(e) {
                    e.preventDefault();
                    var title = document.getElementById('title').value;
                    var content = document.getElementById('content').value;
                    var newPostRef = db.push();
                    newPostRef.set({
                        title: title,
                        content: content
                    }).then(function() {
                        console.log('글이 성공적으로 저장되었습니다.');
                        document.getElementById('postForm').reset();
                        showNotification();
                    }).catch(function(error) {
                        console.error('글 저장 실패:', error);
                    });
                });

                // 글 저장 성공 알림
                function showNotification() {
                    var notification = document.getElementById('notification');
                    notification.style.display = 'block';
                    setTimeout(function() {
                        notification.style.display = 'none';
                    }, 2000);
                }

                // 데이터베이스에서 데이터 읽기
                db.on('child_added', function(snapshot) {
                    var post = snapshot.val();
                    var li = document.createElement('li');
                    li.setAttribute('data-key', snapshot.key);

                    var a = document.createElement('a');
                    a.href = "#";
                    a.textContent = post.title;
                    a.addEventListener('click', function() {
                        alert(post.content);
                    });

                    var deleteButton = document.createElement('button');
                    deleteButton.textContent = "삭제";
                    deleteButton.addEventListener('click', function() {
                        var key = li.getAttribute('data-key');
                        db.child(key).remove();
                    });

                    li.appendChild(a);
                    li.appendChild(deleteButton);
                    document.getElementById('posts').appendChild(li);
                });

                // 데이터베이스에서 데이터 제거 시 화면에서 항목 제거
                db.on('child_removed', function(snapshot) {
                    var key = snapshot.key;
                    var li = document.querySelector('li[data-key="' + key + '"]');
                    if (li) {
                        li.remove();
                    }
                });
            } else {
                console.log('User is signed out.');
            }
        });
    </script>
</body>
</html>
